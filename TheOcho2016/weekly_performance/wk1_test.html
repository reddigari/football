<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>The Ocho</title>
    <link rel="stylesheet" href="https://reddigari.github.io/styles/ff_style.css">
    <link href='https://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://reddigari.github.io/styles/style_functions.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <style>
    #sourceSelect{
        font-family: sans-serif;
    }
    #teamAVERAGE {
      display: block;
      margin: auto;
    }
    </style>
</head>

<body>
    <div id="container">

        <div id="sidebar">
            <div id="field" style="padding:10px">
            <svg width="180" height="80">
              <line x1="2" x2="2" y1="0" y2="80" style="stroke: white; stroke-width:4px;"/>
              <line x1="178" x2="178" y1="0" y2="80" style="stroke: white; stroke-width:4px;"/>
              <line x1="0" x2="180" y1="78" y2="78" style="stroke: white; stroke-width:4px;"/>
              <line x1="0" x2="180" y1="2" y2="2" style="stroke: white; stroke-width:4px;"/>
              <rect x="4" y="4" width="16" height="72" style="stroke-width: 0; fill: blue;"/>
              <rect x="160" y="4" width="16" height="72" style="stroke-width: 0; fill: blue;"/>
              <line x1="20" x2="160" y1="35" y2="35" style="stroke: white; stroke-dasharray: 1, 1"/>
              <line x1="20" x2="160" y1="45" y2="45" style="stroke: white; stroke-dasharray: 1, 1"/>
              <!-- <text x="14" y="40" font-size="8" transform="rotate(-90, 14, 40)" text-anchor="middle" style="fill: #bebebe ">INDIANAPOLIS</text>
              <text x="166" y="40" font-size="8" transform="rotate(90, 166, 40)" text-anchor="middle" style="fill: #bebebe ">COLTS</text> -->
            </svg>
        </div>
            <script>
            var lines = [];
            for(count = 0; count < 21; count++) {lines.push(20+(7*count));};
            d3.select("svg")
                .selectAll(".ydline")
                .data(lines)
                .enter().append("line")
                .style("stroke", "white")
                .style("stroke-width", function(d, i) {if (i%2==0) return "2"; else return "1";})
                .attr("x1", function(d) {return d;})
                .attr("x2", function(d) {return d;})
                .attr("y1", 0)
                .attr("y2", 80);
            </script>
            <ul>
                <li><a href=#>Posts</a></li>
                <li><a href=# style="color: black">The Ocho</a></li>
                <li><a href="https://github.com/reddigari/football">Code</a></li>
            </ul>
        </div>

        <div id="header">
            <h1>Fantasy Football</h1>
        </div>
        <div id="text">
        <div id="wk1Proj">
        <h2>The Ocho: Week 1</h2>


        <!-- <fieldset id="sourceSelect" style="display:inline-block">
            <legend>Source</legend>
            <input type="radio" name="source" value="espn" checked>ESPN</input><br>
            <input type="radio" name="source" value="ffa">FFA</input>
        </fieldset> -->

        <script>
        var margin = {
                top: 30,
                right: 20,
                bottom: 40,
                left: 60
            },
            widthSmall = 350 - margin.left - margin.right,
            heightSmall = 200 - margin.top - margin.bottom
            widthBig = 700 - margin.left - margin.right,
            heightBig = 400 - margin.top - margin.bottom;

        var y = d3.scaleLinear();

        var x = d3.scaleBand()
            .paddingInner(0.25)
            .paddingOuter(0.1);

        var colors = [ "#7f7f7f", "#1f77b4", "#ff7f0e", "#2ca02c", "#d62728", "#9467bd", "#8c564b", "#e377c2", "#bcbd22", "#17becf" ]
        var colorScale = d3.scaleOrdinal(colors);


        d3.json("wk1_proj.json", function(json) {

            // json.sort(function(a, b) { return b[source] - a[source]; });
            json.forEach(function(d) { d.data.forEach(function(dd) {dd.FFPts = parseFloat(dd.FFPts);}) });

            y.domain([0, d3.max(json, function(d) { return d3.max(d.data, function(dd) {return dd.FFPts;}); })+2]);
            x.domain(json[0].data.map(function(d) { return d.Slot; }));
            colorScale.domain(json.map(function(d) { return d.owner; }));

            json.forEach(function(t) {

            if (t.owner=='AVERAGE') {
              var width = widthBig;
              var height = heightBig;
            } else {
              var width = widthSmall;
              var height = heightSmall;
            }

            y.range([height, 0]);
            x.rangeRound([0, width]);

            var xAxis = d3.axisBottom(x)
                .tickSize(0)
                .tickPadding(5);

            var yAxis = d3.axisLeft(y)
                .ticks(5);


            var g = d3.select("#wk1Proj").append("svg")
                .attr("class", "teamProj")
                .attr("id", function() {return "team"+t.owner})
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            g.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis);

            g.append("g")
                .attr("class", "y axis")
                .attr("transform", "translate(-10,0)")
                .call(yAxis);

            g.select(".x.axis").call(xAxis);
            g.select(".y.axis").call(yAxis)
                .style("stroke", "none")
                .append("text")
                .attr("y", height/2)
                .attr("x", -30)
                .attr("fill", "black")
                // .attr("dy", ".71em")
                .style("text-anchor", "middle")
                .text("Projected Fantasy Points")
                .attr("transform", "rotate(-90," + "-30," + height/2 +")");

            if (t.owner=='AVERAGE') {
            var bars = g.selectAll(".rect")
                .data(t.data, function(d) {return d.Slot; });

            bars.enter().append("rect")
                .attr("class", "rect")
                .merge(bars)
                .style("stroke", "none")
                .attr("x", function(d) { return x(d.Slot); })
                .transition()
                .attr("y", function(d) { return y(d.FFPts); })
                .attr("width", x.bandwidth())
                .style("fill", function() {return colorScale(t.owner); })
                .attr("height", function(d) { return height-y(d.FFPts); });
            }

            else {
              var lines = g.selectAll(".line")
                  .data(t.data, function(d) {return d.Slot; });

              lines.enter().append("line")
                  .attr("class", "line")
                  .merge(lines)
                  .style("stroke", function() { return colorScale(t.owner); })
                  .attr("x1", function(d) { return x(d.Slot); })
                  .attr("x2", function(d) { return x(d.Slot) + x.bandwidth(); })
                  .transition()
                  .attr("y1", function(d) { return y(d.FFPts); })
                  .attr("y2", function(d) { return y(d.FFPts); });

              // d3.select("#teamAVERAGE g")
              //     .selectAll(".dots" + t.owner)
              //     .data(t.data)
              //     .enter().append("circle")
              //     .attr("class", "dots"+t.owner)
              //     .style("fill", function() { return colorScale(t.owner); })
              //     .style("stroke-width", 0)
              //     .attr("cx", function(d) { return x(d.Slot) + 0.5*x.bandwidth(); })
              //     .attr("cy", function(d) { return y(d.FFPts); })
              //     .attr("r", 2);

              // var aveLines = g.selectAll(".aveLine")
              //   .data(json[0].data, function(d) {return d.Slot; });
              //
              // aveLines.enter().append("line")
              //     .attr("class", "line")
              //     .merge(aveLines)
              //     .style("stroke", colorScale('AVERAGE'))
              //     .attr("x1", function(d) { return x(d.Slot); })
              //     .attr("x2", function(d) { return x(d.Slot) + x.bandwidth(); })
              //     .transition()
              //     .attr("y1", function(d) { return y(d.FFPts); })
              //     .attr("y2", function(d) { return y(d.FFPts); });
            }

            var labels = g.selectAll(".valLabel")
                .data(t.data, function(d) {return d.Slot; });

            labels.enter().append("text")
                .attr("class", "valLabel")
                .merge(labels)
                .transition()
                .attr("x",  function(d) { return x(d.Slot) + 0.5*x.bandwidth(); })
                .attr("y", function(d) {return y(d.FFPts) - 5; })
                .text(function(d) { return d.FFPts.toFixed(1); })
                .attr("font-size", "10")
                .attr("font-family", "sans-serif")
                .attr("text-anchor", "middle");

            g.append("text")
                .attr("x", 0.5*width)
                .attr("y", 0-(0.5*margin.top))
                .text(function() {
                  if (t.owner=='AVERAGE') return "League Average Projections by Position";
                  else return t.owner;
                })
                .attr("text-anchor", "middle")
                .attr("font-size", "14")
        });

      });
        // d3.selectAll("input")
        //     .on("change", plotBars);
        // plotBars();



        </script>
        </div>
        </div>
    </div>

</html>
